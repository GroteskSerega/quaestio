<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">
   <changeSet author="Sergey Nochvay" id="1766933238162-1">
      <createTable tableName="index">
         <column autoIncrement="true" name="id" type="INT">
            <constraints primaryKey="true"/>
         </column>
         <column name="lemma_id" type="INT">
            <constraints nullable="false"/>
         </column>
         <column name="page_id" type="INT">
            <constraints nullable="false"/>
         </column>
         <column name="rank" type="FLOAT(12)">
            <constraints nullable="false"/>
         </column>
      </createTable>
   </changeSet>
   <changeSet author="Sergey Nochvay" id="1766933238162-2">
      <createTable tableName="lemma">
         <column name="frequency" type="INT">
            <constraints nullable="false"/>
         </column>
         <column autoIncrement="true" name="id" type="INT">
            <constraints primaryKey="true"/>
         </column>
         <column name="site_id" type="INT">
            <constraints nullable="false"/>
         </column>
         <column name="lemma" type="VARCHAR(255)">
            <constraints nullable="false"/>
         </column>
      </createTable>
   </changeSet>
   <changeSet author="Sergey Nochvay" id="1766933238162-3">
      <createTable tableName="page">
         <column name="code" type="INT">
            <constraints nullable="false"/>
         </column>
         <column autoIncrement="true" name="id" type="INT">
            <constraints primaryKey="true"/>
         </column>
         <column name="site_id" type="INT">
            <constraints nullable="false"/>
         </column>
         <column name="content" type="MEDIUMTEXT">
            <constraints nullable="false"/>
         </column>
         <column name="path" type="VARCHAR(512)">
            <constraints nullable="false"/>
         </column>
      </createTable>
   </changeSet>
   <changeSet author="Sergey Nochvay" id="1766933238162-4">
      <createTable tableName="site">
         <column autoIncrement="true" name="id" type="INT">
            <constraints primaryKey="true"/>
         </column>
         <column name="status_time" type="datetime(6)">
            <constraints nullable="false"/>
         </column>
         <column name="last_error" type="TEXT"/>
         <column name="name" type="VARCHAR(255)">
            <constraints nullable="false"/>
         </column>
         <column name="url" type="VARCHAR(255)">
            <constraints nullable="false"/>
         </column>
         <column name="status" type="ENUM('INDEXING', 'INDEXED', 'FAILED')"/>
      </createTable>
   </changeSet>
   <changeSet author="Sergey Nochvay" id="1766933238162-5">
      <addUniqueConstraint columnNames="site_id, lemma"
                           constraintName="idx_lemma_site_id_lemma"
                           tableName="lemma"/>
   </changeSet>
   <changeSet author="Sergey Nochvay" id="1766933238162-6">
      <addUniqueConstraint columnNames="site_id, path"
                           constraintName="idx_page_site_id_path"
                           tableName="page"/>
   </changeSet>
   <changeSet author="Sergey Nochvay" id="1766933238162-7">
      <createIndex indexName="FK3uxy5s82mxfodai0iafb232cs" tableName="index">
         <column name="page_id"/>
      </createIndex>
   </changeSet>
   <changeSet author="Sergey Nochvay" id="1766933238162-8">
      <createIndex indexName="FKiqgm34dkvjdt7kobg71xlbr33" tableName="index">
         <column name="lemma_id"/>
      </createIndex>
   </changeSet>
   <changeSet author="Sergey Nochvay" id="1766933238162-9">
      <createIndex indexName="idx_lemma_lemma" tableName="lemma">
         <column name="lemma"/>
      </createIndex>
   </changeSet>
   <changeSet author="Sergey Nochvay" id="1766933238162-10">
      <createIndex indexName="idx_page_path" tableName="page">
         <column name="path"/>
      </createIndex>
   </changeSet>
   <changeSet author="Sergey Nochvay" id="1766933238162-11">
      <addForeignKeyConstraint baseColumnNames="page_id"
                               baseTableName="index"
                               constraintName="FK3uxy5s82mxfodai0iafb232cs"
                               deferrable="false"
                               initiallyDeferred="false"
                               onDelete="RESTRICT"
                               onUpdate="RESTRICT"
                               referencedColumnNames="id"
                               referencedTableName="page"/>
   </changeSet>
   <changeSet author="Sergey Nochvay" id="1766933238162-12">
      <addForeignKeyConstraint baseColumnNames="site_id"
                               baseTableName="lemma"
                               constraintName="FKfbq251d28jauqlxirb1k2cjag"
                               deferrable="false"
                               initiallyDeferred="false"
                               onDelete="RESTRICT"
                               onUpdate="RESTRICT"
                               referencedColumnNames="id"
                               referencedTableName="site"/>
   </changeSet>
   <changeSet author="Sergey Nochvay" id="1766933238162-13">
      <addForeignKeyConstraint baseColumnNames="lemma_id"
                               baseTableName="index"
                               constraintName="FKiqgm34dkvjdt7kobg71xlbr33"
                               deferrable="false"
                               initiallyDeferred="false"
                               onDelete="RESTRICT"
                               onUpdate="RESTRICT"
                               referencedColumnNames="id"
                               referencedTableName="lemma"/>
   </changeSet>
   <changeSet author="Sergey Nochvay" id="1766933238162-14">
      <addForeignKeyConstraint baseColumnNames="site_id"
                               baseTableName="page"
                               constraintName="FKj2jx0gqa4h7wg8ls0k3y221h2"
                               deferrable="false"
                               initiallyDeferred="false"
                               onDelete="RESTRICT"
                               onUpdate="RESTRICT"
                               referencedColumnNames="id"
                               referencedTableName="site"/>
   </changeSet>
</databaseChangeLog>
